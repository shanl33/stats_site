#library(tidyr)
# For plots
library(ggplot2)
library(plotly)
# For confidence intervals
library(asht)
#### Cook Islands data ####
# Read in data
source("loadData.R")
age_n <- do.call(cbind.data.frame, lapply(ResPopEst$Total[-c(1, 7, 8)], function(x) x*age3_p$Yr2011))
age_n <- cbind(age_n, do.call(cbind.data.frame, lapply(ResPopEst$Total[c(7, 8)], function(x) x*age3_p$Yr2016)))
colnames(age_n) <- rownames(ResPopEst)[-1]
age_n["2011"] <- age3["Yr2011"] # Use Census counts for 2011
WHOweights3 <- count3bands(WHOdf$Propn, a=3, b=9)
W3 <- WHOweights3/(age_n*WHO_sum)
colnames(W3) <- colnames(cancer3bands)
cancerG1 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=cancer3bands, W=W3, SIMPLIFY=FALSE))
mortalityG1 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=mortality3bands, W=W3, SIMPLIFY=FALSE))
cancerG2 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=cancer3bands, W=W3, SIMPLIFY=FALSE, type="tcz"))
mortalityG2 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=mortality3bands, W=W3, SIMPLIFY=FALSE, type="tcz"))
cancerRGK <- RGandK(cancerG1, cancer[4:10])
mortalityRGK <- RGandK(mortalityG1, mortality[4:10])
cancer_allCIs <- rbind(cancerRGK, tidy_htest(cancerG1), tidy_htest(cancerG2, "Gamma_2"))
mortality_allCIs <- rbind(mortalityRGK, tidy_htest(mortalityG1), tidy_htest(mortalityG2, "Gamma_2"))
plot_allCIs(cancer_allCIs) +
ggtitle("Cancer rates for the Cook Islands",
subtitle="Age-adjusted, WHO standardised estimates")
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
library(ggplot2)
library(plotly)
library(asht)
maori18 <- rbind(maoriPopnCounts[1:17, ], (maoriPopnCounts[18, ] + maoriPopnCounts[19, ]))
source("loadData.R")
maori18 <- rbind(maoriPopnCounts[1:17, ], (maoriPopnCounts[18, ] + maoriPopnCounts[19, ]))
colnames(maoriPopn) <- c("Age", 2009:2015)
maoriPopn <- read.csv("data/MaoriPopn.csv")
maoriCancer <- read.csv("data/MaoriLung.csv")
colnames(maoriPopn) <- c("Age", 2009:2015)
maoriPopnCounts <- do.call(cbind.data.frame,
lapply(maoriPopn[-1], function(x) as.numeric(gsub(",", "", x))))
maoriLung <- as.data.frame(t(maoriCancer[-1]))
colnames(maoriLung) <- 2009:2015
maoriStd <- read.csv("data/MaoriStandard2011.csv")
maori18 <- rbind(maoriPopnCounts[1:17, ], (maoriPopnCounts[18, ] + maoriPopnCounts[19, ]))
WHOweights18 <- c(WHOdf$Propn[1:17], sum(WHOdf$Propn[18:21]))
W18 <- WHOweights18/(maori18*WHO_sum)
lungG1 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung, W=W18, SIMPLIFY=FALSE))
lungG2 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung, W=W18, SIMPLIFY=FALSE, type="tcz"))
lungRGK <- RGandK(lungG1, maoriLung)
lung_allCIs <- rbind(lungRGK, tidy_htest(lungG1), tidy_htest(lungG2, "Gamma_2"))
maoriStd$Population <- as.numeric(gsub(",", "", maoriStd$Population))
maoriStd$Age <- factor(c("0-04", "05-09", as.character(maoriStd$Age[3:18])))
Maori_sum <- sum(maoriStd$Population)
MaoriW18 <- maoriStd$Population/(maori18*Maori_sum)
lungG1_intStd <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung, W=MaoriW18, SIMPLIFY=FALSE))
lungG2_intStd <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung, W=MaoriW18, SIMPLIFY=FALSE, type="tcz"))
lungRGK_intStd <- RGandK(lungG1_intStd, maoriLung)
lung_allintStd <- rbind(lungRGK_intStd, tidy_htest(lungG1_intStd),
tidy_htest(lungG2_intStd, "Gamma_2"))
plotly_allCIs <- function(allCIs) {
allCIs$Value <- round(allCIs$Value, 1)
p <- allCIs %>%
group_by(Method) %>%
plot_ly(x=~Year, y=~Value, colour=~Method, legendgroup=~Method, group=~Group, type="scatter", mode="lines")
return(p)
}
plotly_allCIs(lung_allCIs)
data("Orange")
head(Orange)
library(tidyr) #for spread (plotly line plot)
spread(Orange, Tree, circumference)
spread(lung_allCIs)
spread(lung_allCIs, Method, Value)
plotly_allCIs <- function(allCIs) {
allCIs$Value <- round(allCIs$Value, 1)
p <- allCIs %>%
spread(Method, Value) %>%
plot_ly(x=~Year, y=~Estimate, type="scatter", mode="lines", legendgroup=~Estimate, name="Estimate") %>%
add_trace(y=~Keyfitz, legendgroup=~Keyfitz, name="Keyfitz") %>%
add_trace(y=~Rothman/Greenland, legendgroup=~Rothman/Greenland, name="Rothman/Greenland") %>%
add_trace(y=~Gamma_1, legendgroup=~Gamma_1, name="Gamma_1") %>%
add_trace(y=~Gamma_2, legendgroup=~Gamma_2, name="Gamma_2")
return(p)
}
plotly_allCIs(lung_allCIs)
plotly_allCIs <- function(allCIs) {
allCIs$Value <- round(allCIs$Value, 1)
df <- spread(allCIs, Method, Value)
df <- rename(df, c("Group", "Year", "Estimate", "Keyfitz", "RG", "Gamma_1", "Gamma_2"))
p <- plot_ly(x=~Year, y=~Estimate, type="scatter", mode="lines", legendgroup=~Estimate, name="Estimate") %>%
add_trace(y=~Keyfitz, legendgroup=~Keyfitz, name="Keyfitz") %>%
add_trace(y=~RG, legendgroup=~RG, name="Rothman/Greenland") %>%
add_trace(y=~Gamma_1, legendgroup=~Gamma_1, name="Gamma_1") %>%
add_trace(y=~Gamma_2, legendgroup=~Gamma_2, name="Gamma_2")
return(p)
}
plotly_allCIs(lung_allCIs)
plot_allCIs <- function(allCIs) {
allCIs$Value <- round(allCIs$Value, 1)
df <- group_by(allCIs, Method)
ggplot(allCIs, aes(x=Year, y=Value, group=Group, colour=Method, legendgroup=Method)) +
geom_point() +
geom_line() +
theme_classic() +
scale_x_discrete(limits=2009:2015) +
labs(y="Rate per 100 000", colour="")
}
plot_allCIs(lung_allCIs)
MaoriWHO_plot <- plot_allCIs(lung_allCIs) +
scale_y_continuous(limits=c(40, 100)) +
theme(legend.position="none")
MaoriInt_plot <- plot_allCIs(lung_allintStd) +
scale_y_continuous(limits=c(40, 100)) +
ylab("")
plotlyWHO <- ggplotly(MaoriWHO_plot, tooltip=c("x", "y", "colour"), showlegend=F)
plotlyInt <- ggplotly(MaoriInt_plot, tooltip=c("x", "y", "colour"))
subplot(plotlyWHO, plotlyInt, shareY=TRUE, titleX=TRUE)
MaoriWHO_plot <- plot_allCIs(lung_allCIs) +
scale_y_continuous(limits=c(40, 100))
MaoriWHO_plot <- plot_allCIs(lung_allCIs) +
scale_y_continuous(limits=c(40, 100))
MaoriInt_plot <- plot_allCIs(lung_allintStd) +
scale_y_continuous(limits=c(40, 100)) +
theme(legend.position="none")
plotlyWHO <- ggplotly(MaoriWHO_plot, tooltip=c("x", "y", "colour"))
plotlyInt <- ggplotly(MaoriInt_plot, tooltip=c("x", "y", "colour"), showlegend=F)
subplot(plotlyWHO, plotlyInt, shareY=TRUE, titleX=TRUE)
subplot(plotlyWHO, plotlyInt, shareY=TRUE, titleX=TRUE) %>%
layout(showlegend=T)
MaoriWHO_plot <- plot_allCIs(lung_allCIs) +
scale_y_continuous(limits=c(40, 100)) +
theme(legend.position="none")
MaoriInt_plot <- plot_allCIs(lung_allintStd) +
scale_y_continuous(limits=c(40, 100))
plotlyWHO <- ggplotly(MaoriWHO_plot, tooltip=c("x", "y", "colour")) %>%
layout(showlegend=F)
plotlyInt <- ggplotly(MaoriInt_plot, tooltip=c("x", "y", "colour"))
subplot(plotlyWHO, plotlyInt, shareY=TRUE, titleX=TRUE)
subplot(pWHO18, pInt, pWHO3, shareY=T, titleX=T) %>%
layout(title="WHO standard (left), Maori 2011 standard (centre), WHO with 3 age-bands (right)", showlegend=F)
pWHO18 <- MaoriWHO_plot +
scale_y_continuous(limits=c(40, 100))
pInt <- MaoriInt_plot +
scale_y_continuous(limits=c(40, 100))
pWHO3 <- MaoriWHO_plot3 +
scale_y_continuous(limits=c(40, 100))
maoriLung3bands <- do.call(cbind.data.frame, lapply(maoriLung, count3bands, b=9))
maori3 <- do.call(cbind.data.frame, lapply(maoriPopnCounts, count3bands, b=9))
W3 <- WHOweights3/(maori3*WHO_sum/100)
lungG1_3 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung3bands, W=W3, SIMPLIFY=FALSE))
lungG2_3 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung3bands, W=W3, SIMPLIFY=FALSE, type="tcz"))
lungRGK_3 <- RGandK(lungG1_3, maoriLung3bands)
lung_allCIs3 <- rbind(lungRGK_3, tidy_htest(lungG1_3), tidy_htest(lungG2_3, "Gamma_2"))
MaoriWHO_plot3 <- plot_allCIs(lung_allCIs3)
pWHO3 <- MaoriWHO_plot3 +
scale_y_continuous(limits=c(40, 100))
subplot(pWHO18, pInt, pWHO3, shareY=T, titleX=T) %>%
layout(title="WHO standard (left), Maori 2011 standard (centre), WHO with 3 age-bands (right)", showlegend=F)
pWHO3 <- MaoriWHO_plot3 +
scale_y_continuous(limits=c(40, 100))
pWH03
pWHO3
W3
head(lung_allCIs3)
MaoriWHO_plot3 <- plot_allCIs(lung_allCIs3)
MaoriWHO_plot3 +
ggtitle("Lung cancer rates for NZ Maori",
subtitle="Age-adjusted, WHO standardised estimates with 3 age-bands")
WHOweights3
W3 <- WHOweights3/(maori3*WHO_sum)
lungG1_3 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung3bands, W=W3, SIMPLIFY=FALSE))
lungG2_3 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung3bands, W=W3, SIMPLIFY=FALSE, type="tcz"))
lungRGK_3 <- RGandK(lungG1_3, maoriLung3bands)
lung_allCIs3 <- rbind(lungRGK_3, tidy_htest(lungG1_3), tidy_htest(lungG2_3, "Gamma_2"))
MaoriWHO_plot3 <- plot_allCIs(lung_allCIs3)
MaoriWHO_plot3 +
ggtitle("Lung cancer rates for NZ Maori",
subtitle="Age-adjusted, WHO standardised estimates with 3 age-bands")
WHOweights3 <- count3bands(WHOdf$Propn, a=3, b=9)/WHO_sum
WHOweights3
WHOweights2
WHOweights18
WHOweights3
W3 <- WHOweights3*100/(age_n*WHO_sum)
colnames(W3) <- colnames(cancer3bands)
cancerG1 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=cancer3bands, W=W3, SIMPLIFY=FALSE))
mortalityG1 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=mortality3bands, W=W3, SIMPLIFY=FALSE))
cancerG2 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=cancer3bands, W=W3, SIMPLIFY=FALSE, type="tcz"))
mortalityG2 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=mortality3bands, W=W3, SIMPLIFY=FALSE, type="tcz"))
cancerRGK <- RGandK(cancerG1, cancer[4:10])
mortalityRGK <- RGandK(mortalityG1, mortality[4:10])
cancer_allCIs <- rbind(cancerRGK, tidy_htest(cancerG1), tidy_htest(cancerG2, "Gamma_2"))
mortality_allCIs <- rbind(mortalityRGK, tidy_htest(mortalityG1), tidy_htest(mortalityG2, "Gamma_2"))
plot_allCIs(cancer_allCIs) +
ggtitle("Cancer rates for the Cook Islands",
subtitle="Age-adjusted, WHO standardised estimates")
plot_allCIs(mortality_allCIs) +
ggtitle("Mortality rates for the Cook Islands",
subtitle="Age-adjusted, WHO standardised estimates")
W3C <- WHOweights3*100/(age_n*WHO_sum)
colnames(W3C) <- colnames(cancer3bands)
W3M <- WHOweights3*100/(maori3*WHO_sum)
rm(W3)
lungG1_3 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung3bands, W=W3M, SIMPLIFY=FALSE))
lungG2_3 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung3bands, W=W3M, SIMPLIFY=FALSE, type="tcz"))
lungRGK_3 <- RGandK(lungG1_3, maoriLung3bands)
lung_allCIs3 <- rbind(lungRGK_3, tidy_htest(lungG1_3), tidy_htest(lungG2_3, "Gamma_2"))
MaoriWHO_plot3 <- plot_allCIs(lung_allCIs3)
pWHO3 <- MaoriWHO_plot3 +
scale_y_continuous(limits=c(40, 100))
subplot(pWHO18, pInt, pWHO3, shareY=T, titleX=T) %>%
layout(title="WHO standard (left), Maori 2011 standard (centre), WHO with 3 age-bands (right)", showlegend=F)
subplot(pWHO18, pInt, pWHO3, shareY=T, titleX=T) %>%
layout(title="WHO standard (left), Maori 2011 standard (centre), WHO standard with 3 age-bands (right)", showlegend=F)
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
# For html output
library(bookdown)
# For tidying data (need?)
#library(tidyr)
# For plots
library(ggplot2)
library(plotly)
# For confidence intervals
library(asht)
#### Cook Islands data ####
# Read in data
source("loadData.R")
plot_allCIs(cancer_allCIs) +
ggtitle("Cancer rates for the Cook Islands",
subtitle="Age-adjusted, WHO standardised estimates")
CIcancerWHOp <- plot_allCIs(cancer_allCIs) +
ggtitle("Cancer rates for the Cook Islands",
subtitle="Age-adjusted, WHO standardised estimates")
CIcancerWHOp <- plot_allCIs(cancer_allCIs)
CImortalityWHOp <- plot_allCIs(mortality_allCIs)
CIcancerWHOp +
ggtitle("Cancer rates for the Cook Islands",
subtitle="Age-adjusted, WHO standardised estimates")
CImortalityWHOp +
ggtitle("Mortality rates for the Cook Islands",
subtitle="Age-adjusted, WHO standardised estimates")
Popn$Yr2011-resPopn$Yr2011
sum(Popn$Yr2011)-sum(resPopn$Yr2011)
mortality
Popn
?wspoissonTest
CImortalityWHOp <- plot_allCIs(mortality_allCIs)
CImortalityWHOp +
ggtitle("Mortality rates for the Cook Islands",
subtitle="Age-adjusted, WHO standardised estimates")
CIcancerWHOp <- plot_allCIs(cancer_allCIs) +
scale_y_continuous(limits=c(0, 250))
CIcancerWHOp +
ggtitle("Cancer rates for the Cook Islands",
subtitle="Age-adjusted, WHO standardised estimates")
CImortalityWHOp +
ggtitle("Mortality rates for the Cook Islands",
subtitle="Age-adjusted, WHO standardised estimates")
CImortalityWHOp <- plot_allCIs(mortality_allCIs) +
scale_y_continuous(limits=c(400, 1000))
CImortalityWHOp +
ggtitle("Mortality rates for the Cook Islands",
subtitle="Age-adjusted, WHO standardised estimates")
WHOweights3
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
library(ggplot2)
library(plotly)
library(asht)
Age <- do.call(cbind.data.frame, lapply(Popn[,-1], age_p))
Age$Yr2006
Age_p <- data.frame(Age=Popn[,1],
Proportion=round(c(Age$Yr2006, Age$Yr2011, Age$Yr2016, WHOweights3), 3),
Census=c(rep(c("2006", "2011", "2016", "WHO"), each=4)))
Age
Popn
Age <- rbind(Age[1:2, ], Age[3, ]+Age[4, ])
Age_p <- data.frame(Age=c("0-14", "15-44", "45+"),
Proportion=round(c(Age$Yr2006, Age$Yr2011, Age$Yr2016, WHOweights3), 3),
Census=c(rep(c("2006", "2011", "2016", "WHO"), each=4)))
Age_p <- data.frame(Age=c("0-14", "15-44", "45+"),
Proportion=round(c(Age$Yr2006, Age$Yr2011, Age$Yr2016, WHOweights3), 3),
Census=c(rep(c("2006", "2011", "2016", "WHO"), each=3)))
ggplot(Age_p, aes(x=Age, y=Proportion, fill=Census)) +
geom_col(position="dodge") +
theme(legend.title=element_blank())
q()
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
# For html output
library(bookdown)
# For tidying data (need?)
#library(tidyr)
# For plots
library(ggplot2)
library(plotly)
# For confidence intervals
library(asht)
#### Cook Islands data ####
# Read in data
source("loadData.R")
maoriCancer <- read.csv("data/MaoriLung.csv")
maoriPopn <- read.csv("data/MaoriPopn.csv")
colnames(maoriPopn) <- c("Age", 2009:2015)
maoriPopnCounts <- do.call(cbind.data.frame,
lapply(maoriPopn[-1], function(x) as.numeric(gsub(",", "", x))))
maoriLung <- as.data.frame(t(maoriCancer[-1]))
colnames(maoriLung) <- 2009:2015
maori18 <- rbind(maoriPopnCounts[1:17, ], (maoriPopnCounts[18, ] + maoriPopnCounts[19, ]))
WHOweights18 <- c(WHOdf$Propn[1:17], sum(WHOdf$Propn[18:21]))
W18 <- WHOweights18/(maori18*WHO_sum)
load("data/WHOdf,RData")
load("data/WHOdf.RData")
WHO_sum <- sum(WHOdf$Propn)
W18 <- WHOweights18/(maori18*WHO_sum)
maori18
maoriLung
lung_crude <- for (i in 1:7) {
sum(maoriLung)/sum(maoriPopnCounts)
}
lung_crude
lung_crude <- for (i in 1:7) {
sum(maoriLung[i])/sum(maoriPopnCounts[i])
}
lung_crude
lung_crude <- for (i in 1:7) {
sum(maoriLung[, i])/sum(maoriPopnCounts[, i])
}
lung_crude
maoriLung[1]
sum(maoriLung[1])
for (i in 1:7) {
lung_crude[i] <- sum(maoriLung[, i])/sum(maoriPopnCounts[, i])
}
for (i in 1:7) {
lung_crude[i] <- sum(maoriLung[, i])/sum(maoriPopnCounts[, i])*100000
}
lung_crude
summary(lung_crude)
# Lung cancer counts in 3-age bands
maoriLung3bands <- do.call(cbind.data.frame, lapply(maoriLung, count3bands, b=9))
#### Functions for calculating, collating results and plotting 95% confidence intervals
## Function for collating results from wspoissonTest()
# Extract the estimate and CI into a data frame for plotting
# Default type="max" is Gamma 1
estimateCI <- function(counts, W, type="max") {
results <- wspoissonTest(counts, W, wmtype=type)
keep <- data.frame(Value = c(results$estimate, results$conf.int[1], results$conf.int[2])*100000,
Group = c("Estimate", "Low", "Up"))
return(keep)
}
## Function for finding CIs using Rothman/Greenland and Keyfitz methods
RGandK <- function(htest, counts) {
# Point estimates from wspoissonTest()
rate <- htest[htest$Group=="Estimate", "Value"]
# Number of observed incidences (for 2009 to 2015)
a <- colSums(counts, na.rm = TRUE)
n <- length(a)
year <- 2009:2015
# Rothman Greenland
Upp_RG <- exp(log(rate)+1.96*sqrt(1/a))
Low_RG <- exp(log(rate)-1.96*sqrt(1/a))
# Keyfitz, 1966
# Assumes standard population is not subject to sampling error, even if directly standardised.
Upp_norm <- rate + 1.96*rate/sqrt(a)
Low_norm <- rate - 1.96*rate/sqrt(a)
CIs <- data.frame(Value=c(Low_RG, Upp_RG, Low_norm, Upp_norm),
Group=rep(c("LowRG", "UpRG", "LowKey", "UpKey"), each=n),
Method=rep(c("Rothman/Greenland", "Keyfitz"), each=2*n),
Year=year)
estimate <- data.frame(Value=rate, Group="Estimate",
Method="Estimate", Year=year)
return(rbind(estimate, CIs))
}
## Function for tidying collated output from wspoissonTest() for plotting
# Remove estimate, add year, group
tidy_htest <- function(htest, group_name="Gamma_1") {
tidy <- htest[htest$Group!="Estimate", ]
tidy$Group <- paste(tidy$Group, group_name, sep="")
tidy$Method <- group_name
tidy$Year <- rep(2009:2015, each=2)
return(tidy)
}
## Function for plotting confidence intervals on one plot
# allCIs needs to be a dataframe with the variables: Year, Value, Group, Method
plot_allCIs <- function(allCIs) {
allCIs$Value <- round(allCIs$Value, 1)
ggplot(allCIs, aes(x=Year, y=Value, group=Group, colour=Method, legendgroup=Method)) +
geom_point() +
geom_line() +
theme_classic() +
scale_x_discrete(limits=2009:2015) +
labs(y="Rate per 100 000", colour="")
}
WHOweights18 <- c(WHOdf$Propn[1:17], sum(WHOdf$Propn[18:21]))
W18 <- WHOweights18/(maori18*WHO_sum)
lungG1 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung, W=W18, SIMPLIFY=FALSE))
lungG2 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung, W=W18, SIMPLIFY=FALSE, type="tcz"))
lungRGK <- RGandK(lungG1, maoriLung)
lung_allCIs <- rbind(lungRGK, tidy_htest(lungG1), tidy_htest(lungG2, "Gamma_2"))
MaoriWHO_plot <- plot_allCIs(lung_allCIs)
maoriStd <- read.csv("data/MaoriStandard2011.csv")
maoriStd$Population <- as.numeric(gsub(",", "", maoriStd$Population))
maoriStd$Age <- factor(c("0-04", "05-09", as.character(maoriStd$Age[3:18])))
MaoriAge_p <- do.call(c, lapply(maori18, age_p))
age_p <- function(x) {
total <- sum(x)
propns <- x/total
return(propns)
}
MaoriAge_p <- do.call(c, lapply(maori18, age_p))
MaoriAge <- data.frame(Age = maoriStd$Age,
Proportion = MaoriAge_p,
Year = rep(2009:2015, each=18))
MaoriAge$Year <- as.factor(MaoriAge$Year)
maoriStandards <- data.frame(Age = rep(maoriStd$Age, 2),
Proportion = c(age_p(maoriStd$Population), 0.01*WHOweights18),
Standard = rep(c("Maori2011", "WHO"), each=18))
MaoriAge$Proportion <- round(MaoriAge$Proportion, 3)
maoriStandards$Proportion <- round(maoriStandards$Proportion, 3)
MaoriAgePlot <- ggplot() +
geom_point(data=MaoriAge, aes(x=Age, y=Proportion, colour=Year)) +
geom_line(data=MaoriAge, aes(x=Age, y=Proportion, colour=Year, group=Year)) +
scale_color_brewer(type="seq") +
theme(panel.grid=element_blank(), panel.background=element_rect(fill="grey70"),
legend.key=element_rect(fill="grey70")) +
labs(title="Age distribution of Maori Population (2009-2015)")
Maori_sum <- sum(maoriStd$Population)
MaoriW18 <- maoriStd$Population/(maori18*Maori_sum)
lungG1_intStd <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung, W=MaoriW18, SIMPLIFY=FALSE))
lungG2_intStd <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung, W=MaoriW18, SIMPLIFY=FALSE, type="tcz"))
lungRGK_intStd <- RGandK(lungG1_intStd, maoriLung)
lung_allintStd <- rbind(lungRGK_intStd, tidy_htest(lungG1_intStd),
tidy_htest(lungG2_intStd, "Gamma_2"))
MaoriInt_plot <- plot_allCIs(lung_allintStd)
pWHO <- MaoriWHO_plot +
scale_y_continuous(limits=c(40, 100)) +
xlab("Year \n WHO standard") +
theme(legend.position="none")
pInt <- MaoriInt_plot +
scale_y_continuous(limits=c(40, 100)) +
xlab("Year \n Maori 2011 standard") +
ggtitle("Age-adjusted, standardised lung cancer rates for NZ Maori")
maoriLung3bands <- do.call(cbind.data.frame, lapply(maoriLung, count3bands, b=9))
count3bands <- function(x, a=1, b=4) {
c(sum(x[1:a]), sum(x[(a+1):b]), sum(x[-(1:b)], na.rm=T))
}
cancer3bands <- do.call(cbind.data.frame, lapply(cancer[-(1:3)], count3bands))
maoriLung3bands <- do.call(cbind.data.frame, lapply(maoriLung, count3bands, b=9))
maori3 <- do.call(cbind.data.frame, lapply(maoriPopnCounts, count3bands, b=9))
W3M <- WHOweights3*100/(maori3*WHO_sum)
WHOweights3 <- count3bands(WHOdf$Propn, a=3, b=9)/WHO_sum
W3M <- WHOweights3*100/(maori3*WHO_sum)
lungG1_3 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung3bands, W=W3M, SIMPLIFY=FALSE))
lungG2_3 <- do.call(rbind.data.frame,
mapply(estimateCI, counts=maoriLung3bands, W=W3M, SIMPLIFY=FALSE, type="tcz"))
lungRGK_3 <- RGandK(lungG1_3, maoriLung3bands)
lung_allCIs3 <- rbind(lungRGK_3, tidy_htest(lungG1_3), tidy_htest(lungG2_3, "Gamma_2"))
MaoriWHO_plot3 <- plot_allCIs(lung_allCIs3)
MaoriWHO_plot3 +
ggtitle("Lung cancer rates for NZ Maori",
subtitle="Age-adjusted, WHO standardised estimates with 3 age-bands")
pWHO18 <- MaoriWHO_plot +
scale_y_continuous(limits=c(20, 100))
pInt <- MaoriInt_plot +
scale_y_continuous(limits=c(20, 100))
pWHO3 <- MaoriWHO_plot3 +
scale_y_continuous(limits=c(20, 100))
subplot(pWHO18, pInt, pWHO3, shareY=T, titleX=T) %>%
layout(title="WHO standard (left), Maori 2011 standard (centre), WHO standard with 3 age-bands (right)", showlegend=F)
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
library(ggplot2)
library(plotly)
library(asht)
Age_p <- data.frame(Age=c("0-14", "15-44", "45+"),
Proportion=round(c(Age$Yr2011, Age$Yr2016, WHOweights3), 3),
Census=c(rep(c("2011", "2016", "WHO"), each=3)))
Age <- do.call(cbind.data.frame, lapply(Popn[,-1], age_p))
Age <- rbind(Age[1:2, ], Age[3, ]+ Age[4, ])
Age_p <- data.frame(Age=c("0-14", "15-44", "45+"),
Proportion=round(c(Age$Yr2011, Age$Yr2016, WHOweights3), 3),
Census=c(rep(c("2011", "2016", "WHO"), each=3)))
p1 <- ggplot(Age_p, aes(x=Age, y=Proportion, fill=Census)) +
geom_col(position="dodge") +
theme(legend.title=element_blank())
ggplotly(p1)
q()
setwd("~/Desktop/Project/github_sites/stats_site")
rmarkdown::render_site()
rmarkdown::render_site()
q()
